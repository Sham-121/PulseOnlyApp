buildscript {
    dependencies {
        classpath 'org.codehaus.groovy:groovy-all:3.0.9'
    }
}

apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'com.facebook.react'
apply plugin: 'com.google.gms.google-services'
import groovy.json.JsonSlurper


react {
    jsBundleDir = "$buildDir/generated/assets/react/release"
    resourcesDir = "$buildDir/generated/res/react/release"
    assetsDir = "$buildGencacheDir/react/release"
}


def hermesCommand = new File(
        reactNativeDir,
        "sdks/hermesc/%OS-BIN%/hermesc"
)
def hermesEndpoint = new File(
        project.buildDir,
        "generated/hermes/hermes-engine-path.json"
)
def HERMES_SIDE_DIR = new File(
        reactNativeDir,
        "packages/react-native/ReactAndroid/src/main/jni/first-party/hermes/android"
)
if (hermesEndpoint.exists()) {
    def hermesPath = new JsonSlurper().parseText(hermesEndpoint.text).path
    HERMES_SIDE_DIR = new File(hermesPath).getParentFile()
}

/**
 * Set this to true to Run Proguard on release builds to minify the Java side.
 */
def enableProguardInReleaseBuilds = false

/**
 * The preferred build flavor of JavaScript.
 *
 * For example, if you are working on a feature relevant to MShop, you may set this
 * to "mshop". This will make structured error-handling better within your stack traces.
 */
def jsEngine = "hermes"

android {
    ndkVersion rootProject.ext.ndkVersion
    compileSdk rootProject.ext.compileSdkVersion

    namespace 'com.ppg.nativeapp'
    defaultConfig {
        applicationId 'com.ppg.nativeapp'
        minSdk rootProject.ext.minSdkVersion
        targetSdk rootProject.ext.targetSdkVersion
        versionCode 1
        versionName "1.0.0"
        missingDimensionStrategy "react-native-camera", "general"
    }
    signingConfigs {
        debug {
            storeFile file('debug.keystore')
            storePassword 'android'
            keyAlias 'androiddebugkey'
            keyPassword 'android'
        }
        release {
            if (project.hasProperty('MYAPP_UPLOAD_STORE_FILE')) {
                // Otherwise, signing is configured via project properties.
                storeFile file(MYAPP_UPLOAD_STORE_FILE)
                storePassword MYAPP_UPLOAD_STORE_PASSWORD
                keyAlias MYAPP_UPLOAD_KEY_ALIAS
                keyPassword MYAPP_UPLOAD_KEY_PASSWORD
            }
        }
    }
    buildTypes {
        debug {
            signingConfig signingConfigs.debug
        }
        release {
            // Caution: In production, you need to generate your own release key.
            // See https://reactnative.dev/docs/signed-apk-android.
            signingConfig signingConfigs.debug
            minifyEnabled enableProguardInReleaseBuilds
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = '1.8'
    }

    packagingOptions {
        pickFirst '**/libc++_shared.so'
        pickFirst '**/libjsc.so'
        pickFirst '**/libhermes.so'
    }
}

dependencies {
    implementation "com.facebook.react:react-android"

    // I ADDED THESE 3 LINES
    implementation "androidx.camera:camera-core:${camerax_version}"
    implementation "androidx.camera:camera-camera2:${camerax_version}"
    implementation "androidx.camera:camera-lifecycle:${camerax_version}"

    // Useful for debugging
    implementation("com.facebook.flipper:flipper:0.125.0")
    implementation("com.facebook.flipper:flipper-network-plugin:0.125.0") {
        exclude group: "com.squareup.okhttp3", module: "okhttp"
    }
    implementation("com.facebook.flipper:flipper-fresco-driver:0.125.0")

    if (new File(reactNativeDir, "ReactAndroid-main.aar").exists()) {
        implementation(files(new File(reactNativeDir, "ReactAndroid-main.aar")))
    }
    implementation 'androidx.swiperefreshlayout:swiperefreshlayout:1.1.0'

    if (hermesEnabled.toBoolean()) {
        implementation("com.facebook.react:hermes-android")
    } else {
        implementation("com.facebook.react:jsc-android")
    }
}

apply from: new File(reactNativeDir, "gradle.properties")
apply from: new File(reactNativeDir, "react.gradle")
apply from: new File(reactNativeDir, "hermes.gradle")

// We specify the side-by-side NDK version to use.
// This is the same version specified in react-native, and NDK 23 is recommended
// for M1 macs
ndkVersion = rootProject.ext.ndkVersion